---
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  name: istio
  namespace: istio-system
spec:
  # meshConfig:
  #   trustDomain: cluster.local
  # values:
  #   global:
  #     caAddress: cert-manager-istio-csr.network.svc:443
  components:
    ingressGateways:
    - enabled: true
      k8s:
        service:
          loadBalancerIP: 192.168.1.180
    # pilot:
    #   k8s:
    #     env:
    #       # Disable istiod CA Sever functionality
    #     - name: ENABLE_CA_SERVER
    #       value: "false"
    #     overlays:
    #     - apiVersion: apps/v1
    #       kind: Deployment
    #       name: istiod
    #       patches:
    #       # Mount istiod serving and webhook certificate from Secret mount
    #       - path: spec.template.spec.containers.[name:discovery].args[-1]
    #         value: "--tlsCertFile=/etc/cert-manager/tls/tls.crt"
    #       - path: spec.template.spec.containers.[name:discovery].args[-1]
    #         value: "--tlsKeyFile=/etc/cert-manager/tls/tls.key"
    #       - path: spec.template.spec.containers.[name:discovery].args[-1]
    #         value: "--caCertFile=/etc/cert-manager/ca/root-cert.pem"
    #       - path: spec.template.spec.containers.[name:discovery].volumeMounts[-1]
    #         value:
    #           name: cert-manager
    #           mountPath: "/etc/cert-manager/tls"
    #           readOnly: true
    #       - path: spec.template.spec.containers.[name:discovery].volumeMounts[-1]
    #         value:
    #           name: ca-root-cert
    #           mountPath: "/etc/cert-manager/ca"
    #           readOnly: true
    #       - path: spec.template.spec.volumes[-1]
    #         value:
    #           name: cert-manager
    #           secret:
    #             secretName: istiod-tls
    #       - path: spec.template.spec.volumes[-1]
    #         value:
    #           name: ca-root-cert
    #           configMap:
    #             defaultMode: 420
    #             name: istio-ca-root-cert
